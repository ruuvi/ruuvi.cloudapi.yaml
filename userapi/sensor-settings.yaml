post: 
  summary: Configure a setting for a sensor
  description: Creates a new setting for given sensor
  operationId: setSensorSetting
  tags:
    - Sensor-Settings
  security:
    - bearerAuth: []
  requestBody:
    required: true
    content:
      application/json:
        schema:
          type: object
          required:
            - sensor
            - value
            - type
          properties:
            sensor:
              type: string
              description: MAC address of the sensor (e.g. `C6:F1:E7:D3:DA:11`)
              pattern: '^([0-9A-Fa-f]{2}:){5}[0-9A-Fa-f]{2}$'
            value:
              type: array
              description: |
                Array of strings
                Example: `["\"CuriousSetting\""]`
              items:
                type: string
            type:
              type: array
              description: Array of setting types (strings)
              items:
                type: string
            timestamp:
              type: integer
              format: int64
              description: Optional epoch timestamp for the setting. If missing, it is assumed to be the current time.
        examples:
          basic:
            value:
              sensor: "C6:F1:E7:D3:DA:11"
              value: ["\"CuriousSetting\""]
              type: ["description"]

  responses:
    '200':
      description: Setting stored or updated successfully
      content:
        application/json:
          schema:
            allOf:
              - $ref: '../components/schemas/Success.yaml'
              - type: object
                properties:
                  data:
                    $ref: '../components/schemas/SettingSetResult.yaml'
          examples:
            updated:
              value:
                result: success
                data:
                  action: "updated"
            added:
              value:
                result: success
                data:
                  action: "added"

    '400':
      description: >
        INVALID - Missing or malformed fields  
        (`sensor`, `value`, or `type` missing; sensor not MAC; value not JSON array; type not array)
      content:
        application/json:
          schema:
            $ref: '../components/schemas/Error.yaml'
          examples:
            invalid:
              value:
                result: "error"
                error: "Sensor must be MAC address"
                code: "ER_INVALID_ARGUMENT"
                sub_code: "ER_INVALID_ARGUMENT"

    '401':
      description: UNAUTHORIZED - Auth token missing
      content:
        application/json:
          schema:
            $ref: '../components/schemas/Error.yaml'
          examples:
            unauthorized:
              value:
                result: "error"
                error: "UNAUTHORIZED"
                code: "ER_UNAUTHORIZED"

    '403':
      description: FORBIDDEN - User does not have permission to edit this sensor
      content:
        application/json:
          schema:
            $ref: '../components/schemas/Error.yaml'
          examples:
            forbidden:
              value:
                result: "error"
                error: "FORBIDDEN"
                code: "ER_FORBIDDEN"

    '404':
      description: NOT FOUND - Sensor does not exist, or it exists but user does not have permission to view this sensor
      content:
        application/json:
          schema:
            $ref: '../components/schemas/Error.yaml'
          examples:
            forbidden:
              value:
                result: "error"
                error: "NOT FOUND"
                code: "ER_NOT_FOUND"

    '409':
      description: CONFLICT - Setting with same or newer timestamp already exists
      content:
        application/json:
          schema:
            $ref: '../components/schemas/Error.yaml'
          examples:
            conflict:
              value:
                result: "error"
                error: "CONFLICT"
                code: "ER_CONFLICT"
                "sub_code": "ER_OLD_ENTRY"

get: 
  summary: Get settings for sensor
  operationId: getSensorSetting
  tags:
    - Sensor-Settings
  security:
    - bearerAuth: []
  description: >
    Returns settings for all sensors owned by the authenticated user.
    Optionally filter by a single sensor MAC address using the `sensor` query parameter.
  parameters:
    - in: query
      name: sensor
      required: false
      description: >
        Filter results to a single sensor by its MAC address (e.g. C6:F1:E7:D3:DA:11).
      schema:
        type: string
        # Uppercase hex with colons, adjust if you accept lowercase as well
        pattern: '^[0-9A-F]{2}(:[0-9A-F]{2}){5}$'
        example: C6:F1:E7:D3:DA:11

  responses:
    '200':
      description: Sensor settings fetched successfully
      content:
        application/json:
          schema:
            allOf:
              - $ref: '../components/schemas/Success.yaml'  # SuccessResult
              - type: object
                required:
                  - data
                properties:
                  data:
                    $ref: '../components/schemas/SettingGetResult.yaml'  # sensors: [Sensor]
          examples:
            basic:
              value:
                result: success
                data:
                  sensors:
                    - owner: "otso@ruuvi.com"
                      sensor: "C6:F1:E7:D3:DA:11"
                      name: "Greenhouse DA11"
                      picture: "Greenhouse.jpg"
                      public: false
                      canShare: true
                      offsetTemperature: 0
                      offsetHumidity: 0
                      offsetPressure: 0
                      customProfile: false
                      lastUpdated: 1732187742
                      subscription:
                        subscriptionName: "Business Standard"
                        maxClaims: 50
                        maxShares: 80
                        maxSharesPerSensor: 10
                        maxHistoryDays: 1096
                        maxResolutionMinutes: 1
                        emailAlertAllowed: true
                        pushAlertAllowed: true
                        telegramAlertAllowed: true
                        delayedAlertAllowed: true
                        pdfExportAllowed: true
                        offlineAlertAllowed: true
                        isActive: true
                        endAt: "2026-07-24T10:35:42.000Z"
                        lastUpdated: 1732187742
                      settings:
                        description: "\"Fridge thermometer\""
                        description_lastUpdated: 1732187742
                        displayOrder: "[\"TEMPERATURE_0\", \"TEMPERATURE_1\", \"HUMIDITY_1\"]"
                        displayOrder_lastUpdated: 1732187742

    '401':
      description: UNAUTHORIZED - Auth token missing
      content:
        application/json:
          schema:
            $ref: '../components/schemas/Error.yaml'
          examples:
            unauthorized:
              value:
                result: "error"
                error: "UNAUTHORIZED"
                code: "ER_UNAUTHORIZED"

    '403':
      description: FORBIDDEN - User does not have access to this sensor
      content:
        application/json:
          schema:
            $ref: '../components/schemas/Error.yaml'
          examples:
            forbidden:
              value:
                result: "error"
                error: "FORBIDDEN"
                code: "ER_FORBIDDEN"

    '404':
      description: NOT FOUND - Sensor does not exist, or it exists but user does not have permission to view this sensor
      content:
        application/json:
          schema:
            $ref: '../components/schemas/Error.yaml'
          examples:
            forbidden:
              value:
                result: "error"
                error: "NOT FOUND"
                code: "ER_NOT_FOUND"

